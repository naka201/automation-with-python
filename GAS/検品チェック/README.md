# 検品管理GASシステム

## 概要

このシステムは、Google Apps Script（GAS）で構築された検品作業を支援するためのウェブアプリケーションです。
作業者は、箱のバーコードを読み取り、検品状況（完了、欠番）、点数、証拠写真を記録できます。記録されたデータはGoogleスプレッドシートに集計され、日々の進捗レポートが自動で生成されます。

## 主な機能

### 1. 検品Webアプリケーション
- **ログイン機能**:
  - 登録されたアカウント情報でのみログインできます。
- **検品ステータス確認**:
  - 箱番号を入力すると、紐づく業者名と現在の検品ステータス（完了/未/欠番）が表示されます。
- **検品作業の記録**:
  - **検品完了**: 点数を入力し、写真をアップロードすることで検品完了を記録します。
  - **欠番処理**: 該当の箱を欠番として記録します。
- **データ記録**:
  - 全ての操作はタイムスタンプ、作業者アカウントと共にGoogleスプレッドシートに記録されます。
  - アップロードされた画像は、指定のGoogleドライブフォルダに月別のフォルダを作成して保存されます。

### 2. 日次進捗レポート機能
- **自動集計**:
  - 毎日定時にトリガーで実行され、その日の検品状況を集計します。
- **レポート生成**:
  - 以下の情報をまとめたレポートを月別のGoogleスプレッドシートに日別シートとして作成します。
    - 本日の検品済み箱リスト
    - 本日検品したが、マスターデータに未入力の箱リスト
    - 前日未入力だったが、本日入力済みになった箱（リカバリー状況）
    - アカウントごとの作業実績（検品箱数、合計点数）
    - 業者ごとの進捗サマリー（総箱数、入力率、検品率）

### 3. 月次データ管理機能
- **自動アーカイブ**:
  - 毎月1日に、先月分の検品データ（スプレッドシート、画像）を専用フォルダに自動でアーカイブします。
- **データクリア**:
  - アーカイブ後、当月分の作業のためにスプレッドシートの入力データをクリアします。

## ファイル構成

```
.
├── .DS_Store
├── dev-plan.md             # 開発計画やアイデアメモ
├── index.html              # 検品作業用のメイン画面UI
├── JavaScript.html         # メイン画面で使われるJavaScriptコード
├── login.html              # ログイン画面のUI
├── todo.txt                # 開発タスクやミーティング議事録
├── コード.gs                 # GASのサーバーサイドロジック全体
├── テスト用データベース.xlsx  # テスト用のデータ（本番では不使用）
└── 検品管理データベース.xlsx  # 本番用のデータベース（Googleスプレッドシート）
```

## 設定方法

### 1. Googleスプレッドシートの準備
1.  `検品管理データベース.xlsx` をGoogleスプレッドシート形式でGoogleドライブにアップロードします。
2.  スプレッドシートには以下のシートが必要です。
    - `検品シート`: 検品データを記録するシート
    - `アカウント`: ログインに使用するアカウント情報を記載するシート
    - `箱番シート`: 箱番号と業者情報を紐づけるシート
3.  同様に、日次レポートで参照する「入力済みマスター」のスプレッドシートも準備します。

### 2. GASプロジェクトの設定
1.  `コード.gs` をGASプロジェクトにコピーします。
2.  `コード.gs` の冒頭にある以下の定数を、ご自身の環境に合わせて設定します。
    - `DATABASE_SHEET_ID`: 手順1で準備した「検品管理データベース」スプレッドシートのID。
    - `INPUT_SHEET_ID`: 「入力済みマスター」スプレッドシートのID。
    - `OUTPUT_FOLDER_ID`: 日次レポートを出力するGoogleドライブのフォルダID。

### 3. トリガーの設定
以下の関数に対して、トリガーを設定します。

- **日次レポート生成**:
  - 関数: `runDailyProgressCheck`
  - 実行タイミング: 毎日、業務終了後など任意の時刻（例: 午後10時〜11時）
- **月次アーカイブ処理**:
  - 関数: `archiveAndClearMonthlyData`
  - 実行タイミング: 毎月1日の午前1時〜2時など
- **月次画像フォルダ作成**:
  - 関数: `createMonthlyFolder`
  - 実行タイミング: 毎月1日の午前0時〜1時など

### 4. Webアプリケーションのデプロイ
1.  GASエディタで `デプロイ` > `新しいデプロイ` を選択します。
2.  種類として「ウェブアプリ」を選択し、アクセスできるユーザーを適切に設定してデプロイします。
3.  生成されたウェブアプリのURLを関係者に共有します。

